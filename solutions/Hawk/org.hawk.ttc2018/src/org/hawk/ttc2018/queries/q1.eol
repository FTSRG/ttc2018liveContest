var sorted = Post.all
  .collect(p|Sequence {p.id, p.score()})
  .sortBy(ps|-ps.second);
return sorted.subList(0, sorted.size.min(3));

operation Submission score() : Integer {
  return self.closure(p|p.comments)
    .flatten
    .collect(p | 10 + p.likedBy.size)
    .sum();
}
